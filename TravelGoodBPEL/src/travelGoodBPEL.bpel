<?xml version="1.0" encoding="UTF-8" ?>
<process
    name="travelGoodBPEL"
    targetNamespace="http://enterprise.netbeans.org/bpel/TravelGoodBPEL/travelGoodBPEL"
    xmlns:tns="http://enterprise.netbeans.org/bpel/TravelGoodBPEL/travelGoodBPEL"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor2"
    xmlns:sxat="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Attachment"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" xmlns:sxxf="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/XPathFunctions" xmlns:ns0="http://j2ee.netbeans.org/wsdl/TravelGoodBPEL/src/TravelGoodClient" xmlns:ns1="http://enterprise.netbeans.org/bpel/WizardCorrelationProperties" xmlns:ns2="http://MMMNGG.dtu.com/" xmlns:ns3="http://NiceView.com/">
   <import namespace="http://j2ee.netbeans.org/wsdl/TravelGoodBPEL/src/TravelGoodClient" location="TravelGoodClient.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <import namespace="http://MMMNGG.dtu.com/" location="http://localhost:8080/LameDuck/MainWebService?wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <import namespace="http://NiceView.com/" location="http://localhost:8080/NiceView/NiceViewService?wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <import namespace="http://enterprise.netbeans.org/bpel/NiceViewServiceWrapper" location="NiceViewServiceWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <import namespace="http://enterprise.netbeans.org/bpel/MainWebServiceWrapper" location="MainWebServiceWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <import namespace="http://enterprise.netbeans.org/bpel/WizardCorrelationProperties" location="WizardCorrelationProperties.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
   <partnerLinks>
      <partnerLink name="NiceView" xmlns:tns="http://enterprise.netbeans.org/bpel/NiceViewServiceWrapper" partnerLinkType="tns:NiceViewLinkType" partnerRole="NiceViewRole"/>
      <partnerLink name="LameDuck" xmlns:tns="http://enterprise.netbeans.org/bpel/MainWebServiceWrapper" partnerLinkType="tns:LameDuckWebServiceLinkType" partnerRole="LameDuckWebServiceRole"/>
      <partnerLink name="client" xmlns:tns="http://j2ee.netbeans.org/wsdl/TravelGoodBPEL/src/TravelGoodClient" partnerLinkType="tns:TravelGoodClient" myRole="TravelGoodClientPortTypeRole"/>
   </partnerLinks>
   <variables>
      <variable name="Fault1FaultVar" messageType="ns0:fault"/>
      <variable name="fault" messageType="sxeh:faultMessage"/>
      <variable name="postPlanningCancelFail" type="xs:boolean"/>
      <variable name="CancelItineraryPostPlanningOut" messageType="ns0:cancelItineraryPostPlanningResponse"/>
      <variable name="CancelItineraryPostPlanningIn" messageType="ns0:cancelItineraryPostPlanningRequest"/>
      <variable name="GetItineraryOut3" messageType="ns0:getItineraryResponse"/>
      <variable name="GetItineraryIn3" messageType="ns0:getItineraryRequest"/>
      <variable name="GetItineraryPostPlanningOut" messageType="ns0:getItineraryPostPlanningResponse"/>
      <variable name="GetItineraryPostPlanningIn" messageType="ns0:getItineraryPostPlanningRequest"/>
      <variable name="GetItineraryOut2" messageType="ns0:getItineraryResponse"/>
      <variable name="GetItineraryIn2" messageType="ns0:getItineraryRequest"/>
      <variable name="GetItineraryOut1" messageType="ns0:getItineraryResponse"/>
      <variable name="GetItineraryIn1" messageType="ns0:getItineraryRequest"/>
      <variable name="isBooked" type="xs:boolean"/>
      <variable name="flightBookingStop" type="xs:boolean"/>
      <variable name="hotelBookingStop" type="xs:boolean"/>
      <variable name="BookItineraryToClient" messageType="ns0:bookItineraryResponse"/>
      <variable name="BookItineraryFromClient" messageType="ns0:bookItineraryRequest"/>
      <variable name="AddHotelOut" messageType="ns0:addHotelResponse"/>
      <variable name="AddHotelIn" messageType="ns0:addHotelRequest"/>
      <variable name="numberOfHotels" type="xs:integer"/>
      <variable name="numberOfFlights" type="xs:integer"/>
      <variable name="GetItineraryOut" messageType="ns0:getItineraryResponse"/>
      <variable name="GetItineraryIn" messageType="ns0:getItineraryRequest"/>
      <variable name="AddFlightToClient" messageType="ns0:addFlightResponse"/>
      <variable name="AddFlightFromClient" messageType="ns0:addFlightRequest"/>
      <variable name="GetHotelsToClient" messageType="ns0:getHotelsResponse"/>
      <variable name="GetHotelsFromServer" xmlns:tns="http://NiceView.com/" messageType="tns:getHotelsResponse"/>
      <variable name="GetHotelsToServer" xmlns:tns="http://NiceView.com/" messageType="tns:getHotels"/>
      <variable name="GetHotelsFromClient" messageType="ns0:getHotelsRequest"/>
      <variable name="GetFlightsToClient" messageType="ns0:getFlightsResponse"/>
      <variable name="GetFlightsFromServer" xmlns:tns="http://MMMNGG.dtu.com/" messageType="tns:getFlightsResponse"/>
      <variable name="GetFlightsToServer" xmlns:tns="http://MMMNGG.dtu.com/" messageType="tns:getFlights"/>
      <variable name="GetFlightsFromClient" messageType="ns0:getFlightsRequest"/>
      <variable name="CancelItineraryOut" messageType="ns0:cancelResponse"/>
      <variable name="cancelPlanning" messageType="ns0:cancelRequest"/>
      <variable name="isCancelled" type="xs:boolean"/>
      <variable name="hotelList" type="ns0:hotelList">
         <sxed:editor>
            <sxed:predicate path="$hotelList/hotelInfo[$numberOfHotels]" source="to"/>
            <sxed:predicate path="$hotelList/hotelInfo[$ForEach3Counter]" source="from"/>
            <sxed:predicate path="$hotelList/hotelInfo[$ForEach3Counter]" source="to"/>
            <sxed:predicate path="$hotelList/hotelInfo[$ForEach4Counter]" source="to"/>
            <sxed:predicate path="$hotelList/hotelInfo[$ForEach4Counter]" source="from"/>
            <sxed:predicate path="$hotelList/hotelInfo[$ForEach6Counter]" source="from"/>
            <sxed:predicate path="$hotelList/hotelInfo[$ForEach6Counter]" source="to"/>
         </sxed:editor>
      </variable>
      <variable name="flightList" type="ns0:flightList">
          <sxed:editor>
            <sxed:predicate path="$flightList/flightInfo[$numberOfFlights]" source="to"/>
             <sxed:predicate path="$flightList/flightInfo[$ForEach1Counter]" source="from"/>
             <sxed:predicate path="$flightList/flightInfo[$ForEach1Counter]" source="to"/>
             <sxed:predicate path="$flightList/flightInfo[$ForEach2Counter]" source="from"/>
             <sxed:predicate path="$flightList/flightInfo[$ForEach2Counter]" source="to"/>
             <sxed:predicate path="$flightList/flightInfo[$ForEach5Counter]" source="from"/>
             <sxed:predicate path="$flightList/flightInfo[$ForEach5Counter]" source="to"/>
          </sxed:editor>
      </variable>
      <variable name="CreateItineraryOut" xmlns:tns="http://j2ee.netbeans.org/wsdl/TravelGoodBPEL/src/TravelGoodClient" messageType="tns:createItineraryResponse"/>
      <variable name="CreateItineraryIn" xmlns:tns="http://j2ee.netbeans.org/wsdl/TravelGoodBPEL/src/TravelGoodClient" messageType="tns:createItineraryRequest"/>
   </variables>
   <correlationSets>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick1_cancelItinerary" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick1_cancelItinerary_1" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick1_getFlights" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick1_getHotels" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick1_addFlight" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick1_getItinerary" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick1_addHotel" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick1_bookItinerary" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick2_getItinerary" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_Receive1" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_Receive1_1" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick2_getItinerary_1" properties="ns1:wzrd_prop_string_string"/>
      <correlationSet name="wzrd_set_Reply1_OnMessage_Pick2_cancelItineraryPostPlanning" properties="ns1:wzrd_prop_string_string"/>
   </correlationSets>
   <sequence>
      <receive name="createItinerary" createInstance="yes" partnerLink="client" operation="createItinerary" xmlns:tns="http://j2ee.netbeans.org/wsdl/TravelGoodBPEL/src/TravelGoodClient" portType="tns:TravelGoodClientPortType" variable="CreateItineraryIn"/>
      <assign name="Assign1">
          <copy>
            <from>false()</from>
            <to variable="isBooked"/>
         </copy>
         <copy>
            <from>false()</from>
            <to variable="postPlanningCancelFail"/>
         </copy>
         <copy>
            <from>''</from>
            <to>$hotelList/hotelInfo</to>
         </copy>
         <copy>
            <from>''</from>
            <to>$flightList/flightInfo</to>
         </copy>
         <copy>
            <from>false()</from>
            <to variable="isCancelled"/>
         </copy>
         <copy>
            <from>0</from>
            <to variable="numberOfHotels"/>
         </copy>
         <copy>
            <from>0</from>
            <to variable="numberOfFlights"/>
         </copy>
         <copy>
            <from>sxxf:getGUID()</from>
            <to variable="CreateItineraryOut" part="uid"/>
         </copy>
         <copy>
            <from>false()</from>
            <to variable="flightBookingStop"/>
         </copy>
         <copy>
            <from>false()</from>
            <to variable="hotelBookingStop"/>
         </copy>
      </assign>
      <reply name="Reply1" partnerLink="client" operation="createItinerary" xmlns:tns="http://j2ee.netbeans.org/wsdl/TravelGoodBPEL/src/TravelGoodClient" portType="tns:TravelGoodClientPortType" variable="CreateItineraryOut">
         <correlations>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick1_cancelItinerary" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick1_cancelItinerary_1" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick1_getFlights" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick1_getHotels" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick1_addFlight" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick1_getItinerary" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick1_addHotel" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick1_bookItinerary" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick2_getItinerary" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_Receive1" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_Receive1_1" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick2_getItinerary_1" initiate="yes"/>
            <correlation set="wzrd_set_Reply1_OnMessage_Pick2_cancelItineraryPostPlanning" initiate="yes"/>
         </correlations>
      </reply>
      <while name="While1">
         <condition>not($isCancelled)</condition>
         <sequence name="Sequence16">
            <if name="If8">
               <condition>$isBooked</condition>
               <!--sequence name="Sequence17">
                  <pick name="Pick2">
                     <onMessage partnerLink="client" operation="getItinerary" portType="ns0:TravelGoodClientPortType" variable="GetItineraryIn1">
                        <correlations>
                           <correlation set="wzrd_set_Reply1_OnMessage_Pick2_getItinerary" initiate="no"/>
                        </correlations>
                        <sequence name="Sequence18">
                           <assign name="Assign21">
                              <copy>
                                 <from variable="flightList"/>
                                 <to variable="GetItineraryOut1" part="flights"/>
                              </copy>
                              <copy>
                                 <from variable="hotelList"/>
                                 <to variable="GetItineraryOut1" part="hotels"/>
                              </copy>
                           </assign>
                           <reply name="Reply8" partnerLink="client" operation="getItinerary" portType="ns0:TravelGoodClientPortType" variable="GetItineraryOut1"/>
                        </sequence>
                     </onMessage>
                  </pick>
               </sequence-->
               <sequence name="Sequence17">
                  <pick name="Pick2">
                     <onMessage partnerLink="client" operation="getItineraryPostPlanning" portType="ns0:TravelGoodClientPortType" variable="GetItineraryPostPlanningIn">
                        <correlations>
                           <correlation set="wzrd_set_Reply1_OnMessage_Pick2_getItinerary_1" initiate="no"/>
                        </correlations>
                        <sequence name="Sequence18">
                           <assign name="Assign22">
                              <copy>
                                 <from variable="hotelList"/>
                                 <to variable="GetItineraryPostPlanningOut" part="hotels"/>
                              </copy>
                              <copy>
                                 <from variable="flightList"/>
                                 <to variable="GetItineraryPostPlanningOut" part="flights"/>
                              </copy>
                           </assign>
                           <reply name="Reply9" partnerLink="client" operation="getItineraryPostPlanning" portType="ns0:TravelGoodClientPortType" variable="GetItineraryPostPlanningOut"/>
                        </sequence>
                     </onMessage>
                     <onMessage partnerLink="client" operation="cancelItineraryPostPlanning" portType="ns0:TravelGoodClientPortType" variable="CancelItineraryPostPlanningIn">
                        <correlations>
                           <correlation set="wzrd_set_Reply1_OnMessage_Pick2_cancelItineraryPostPlanning" initiate="no"/>
                        </correlations>
                        <sequence name="Sequence19">
                           <forEach name="ForEach5" parallel="no" counterName="ForEach5Counter">
                              <startCounterValue>1</startCounterValue>
                              <finalCounterValue>$numberOfFlights</finalCounterValue>
                              <scope name="Scope5">
                                 <variables>
                                    <variable name="CancelFlightsOut" messageType="ns2:cancelFlightsResponse"/>
                                    <variable name="CancelFlightsIn" messageType="ns2:cancelFlights"/>
                                 </variables>
                                 <if name="If10">
                                    <condition>$flightList/flightInfo[$ForEach5Counter]/isBooked
                                       <sxed:editor>
                                          <sxed:predicate path="$flightList/flightInfo[$ForEach5Counter]" source="from"/>
                                       </sxed:editor>
                                    </condition>
                                    <sequence name="Sequence24">
                                       <assign name="Assign25">
                                          <copy>
                                             <from variable="CancelItineraryPostPlanningIn" part="ccInfo"/>
                                             <to>$CancelFlightsIn.parameters/creditCard</to>
                                          </copy>
                                          <copy>
                                             <from>$flightList/flightInfo[$ForEach5Counter]/price
                                                <sxed:editor>
                                                   <sxed:predicate path="$flightList/flightInfo[$ForEach5Counter]" source="from"/>
                                                </sxed:editor>
                                             </from>
                                             <to>$CancelFlightsIn.parameters/amount</to>
                                          </copy>
                                          <copy>
                                             <from>$flightList/flightInfo[$ForEach5Counter]/bookingNumber
                                                <sxed:editor>
                                                   <sxed:predicate path="$flightList/flightInfo[$ForEach5Counter]" source="from"/>
                                                </sxed:editor>
                                             </from>
                                             <to>$CancelFlightsIn.parameters/bookingnumber</to>
                                          </copy>
                                       </assign>
                                       <invoke name="Invoke6" partnerLink="LameDuck" operation="cancelFlights" portType="ns2:LameDuckWebService" inputVariable="CancelFlightsIn" outputVariable="CancelFlightsOut"/>
                                       <assign name="Assign26">
                                          <copy>
                                             <from>not($CancelFlightsOut.parameters/return)</from>
                                             <to>$flightList/flightInfo[$ForEach5Counter]/isBooked
                                                <sxed:editor>
                                                   <sxed:predicate path="$flightList/flightInfo[$ForEach5Counter]" source="to"/>
                                                </sxed:editor>
                                             </to>
                                          </copy>
                                          <copy>
                                             <from>$postPlanningCancelFail or not($CancelFlightsOut.parameters/return)</from>
                                             <to variable="postPlanningCancelFail"/>
                                          </copy>
                                       </assign>
                                    </sequence>
                                    <else>
                                       <empty name="Empty8"/>
                                    </else>
                                 </if>
                              </scope>
                           </forEach>
                           <forEach name="ForEach6" parallel="no" counterName="ForEach6Counter">
                              <startCounterValue>1</startCounterValue>
                              <finalCounterValue>$numberOfHotels</finalCounterValue>
                              <scope name="Scope6">
                                 <variables>
                                    <variable name="CancelHotelOut" messageType="ns3:cancelHotelResponse"/>
                                    <variable name="CancelHotelIn" messageType="ns3:cancelHotel"/>
                                 </variables>
                                 <faultHandlers>
                                    <catchAll>
                                       <sequence name="Sequence26">
                                          <assign name="Assign29">
                                             <copy>
                                                <from>true()</from>
                                                <to>$hotelList/hotelInfo[$ForEach6Counter]/isBooked
                                                   <sxed:editor>
                                                      <sxed:predicate path="$hotelList/hotelInfo[$ForEach6Counter]" source="to"/>
                                                   </sxed:editor>
                                                </to>
                                             </copy>
                                          </assign>
                                          <compensate name="Compensate2"/>
                                       </sequence>
                                    </catchAll>
                                 </faultHandlers>
                                 <compensationHandler>
                                     <assign name="Assign30">
                                         <copy>
                                             <from>true()</from>
                                             <to>$hotelList/hotelInfo[$ForEach6Counter]/isBooked
                                                 <sxed:editor>
                                                     <sxed:predicate path="$hotelList/hotelInfo[$ForEach6Counter]" source="to"/>
                                                 </sxed:editor>
                                             </to>
                                         </copy>
                                     </assign>
                                 </compensationHandler>
                                 <if name="If11">
                                    <condition>$hotelList/hotelInfo[$ForEach6Counter]/isBooked
                                       <sxed:editor>
                                          <sxed:predicate path="$hotelList/hotelInfo[$ForEach6Counter]" source="from"/>
                                       </sxed:editor>
                                    </condition>
                                    <sequence name="Sequence25">
                                       <assign name="Assign27">
                                          <copy>
                                             <from>$hotelList/hotelInfo[$ForEach6Counter]/bookingNumber
                                                <sxed:editor>
                                                   <sxed:predicate path="$hotelList/hotelInfo[$ForEach6Counter]" source="from"/>
                                                </sxed:editor>
                                             </from>
                                             <to>$CancelHotelIn.parameters/bookingNumber</to>
                                          </copy>
                                       </assign>
                                       <invoke name="Invoke7" partnerLink="NiceView" operation="cancelHotel" portType="ns3:NiceView" inputVariable="CancelHotelIn" outputVariable="CancelHotelOut"/>
                                       <assign name="Assign28">
                                          <copy>
                                             <from>not($CancelHotelOut.parameters/return)</from>
                                             <to>$hotelList/hotelInfo[$ForEach6Counter]/isBooked
                                                <sxed:editor>
                                                   <sxed:predicate path="$hotelList/hotelInfo[$ForEach6Counter]" source="to"/>
                                                </sxed:editor>
                                             </to>
                                          </copy>
                                       </assign>
                                    </sequence>
                                 </if>
                              </scope>
                           </forEach>
                           <assign name="Assign31">
                              <copy>
                                 <from>not($postPlanningCancelFail)</from>
                                 <to variable="CancelItineraryPostPlanningOut" part="ok"/>
                              </copy>
                           </assign>
                           <reply name="Reply10" partnerLink="client" operation="cancelItineraryPostPlanning" portType="ns0:TravelGoodClientPortType" variable="CancelItineraryPostPlanningOut"/>
                        </sequence>
                     </onMessage>
                  </pick>
               </sequence>
               <else>
                  <pick name="Pick1">
                     <onMessage partnerLink="client" operation="cancelItinerary" portType="ns0:TravelGoodClientPortType" variable="cancelPlanning">
                           <correlations>
                                 <correlation set="wzrd_set_Reply1_OnMessage_Pick1_cancelItinerary" initiate="no"/>
                                    <correlation set="wzrd_set_Reply1_OnMessage_Pick1_cancelItinerary_1" initiate="no"/>
                              </correlations>
                              <sequence name="Sequence1">
                                 <assign name="Assign2">
                                       <copy>
                                             <from>true()</from>
                                                <to variable="isCancelled"/>
                                          </copy>
                                          <copy>
                                             <from>true()</from>
                                                <to variable="CancelItineraryOut" part="ok"/>
                                          </copy>
                                    </assign>
                                    <reply name="cancelPlanning" partnerLink="client" operation="cancelItinerary" portType="ns0:TravelGoodClientPortType" variable="CancelItineraryOut"/>
                              </sequence>
                        </onMessage>
                        <onMessage partnerLink="client" operation="getFlights" portType="ns0:TravelGoodClientPortType" variable="GetFlightsFromClient">
                           <correlations>
                                 <correlation set="wzrd_set_Reply1_OnMessage_Pick1_getFlights" initiate="no"/>
                              </correlations>
                              <sequence name="Sequence2">
                                 <assign name="Assign3">
                                       <copy>
                                             <from variable="GetFlightsFromClient" part="from"/>
                                                <to>$GetFlightsToServer.parameters/from</to>
                                          </copy>
                                          <copy>
                                             <from variable="GetFlightsFromClient" part="to"/>
                                                <to>$GetFlightsToServer.parameters/toDestination</to>
                                          </copy>
                                          <copy>
                                             <from variable="GetFlightsFromClient" part="departureDate"/>
                                                <to>$GetFlightsToServer.parameters/arg2</to>
                                          </copy>
                                    </assign>
                                    <invoke name="getFlights" partnerLink="LameDuck" operation="getFlights" portType="ns2:LameDuckWebService" inputVariable="GetFlightsToServer" outputVariable="GetFlightsFromServer"/>
                                    <assign name="Assign4">
                                       <copy>
                                             <from>$GetFlightsFromServer.parameters/return</from>
                                                <to>$GetFlightsToClient.flightList/return</to>
                                          </copy>
                                    </assign>
                                    <reply name="Reply2" partnerLink="client" operation="getFlights" portType="ns0:TravelGoodClientPortType" variable="GetFlightsToClient"/>
                              </sequence>
                        </onMessage>
                        <onMessage partnerLink="client" operation="getHotels" portType="ns0:TravelGoodClientPortType" variable="GetHotelsFromClient">
                           <correlations>
                                 <correlation set="wzrd_set_Reply1_OnMessage_Pick1_getHotels" initiate="no"/>
                              </correlations>
                              <sequence name="Sequence3">
                                 <assign name="Assign5">
                                       <copy>
                                             <from variable="GetHotelsFromClient" part="arrivalDate"/>
                                                <to>$GetHotelsToServer.parameters/arrival</to>
                                          </copy>
                                          <copy>
                                             <from variable="GetHotelsFromClient" part="departureDate"/>
                                                <to>$GetHotelsToServer.parameters/departure</to>
                                          </copy>
                                          <copy>
                                             <from variable="GetHotelsFromClient" part="city"/>
                                                <to>$GetHotelsToServer.parameters/city</to>
                                          </copy>
                                    </assign>
                                    <invoke name="Invoke1" partnerLink="NiceView" operation="getHotels" portType="ns3:NiceView" inputVariable="GetHotelsToServer" outputVariable="GetHotelsFromServer"/>
                                    <assign name="Assign6">
                                       <copy>
                                             <from>$GetHotelsFromServer.parameters</from>
                                                <to>$GetHotelsToClient.hotelList</to>
                                          </copy>
                                    </assign>
                                    <reply name="Reply3" partnerLink="client" operation="getHotels" portType="ns0:TravelGoodClientPortType" variable="GetHotelsToClient"/>
                              </sequence>
                        </onMessage>
                        <onMessage partnerLink="client" operation="addFlight" portType="ns0:TravelGoodClientPortType" variable="AddFlightFromClient">
                           <correlations>
                                 <correlation set="wzrd_set_Reply1_OnMessage_Pick1_addFlight" initiate="no"/>
                              </correlations>
                              <sequence name="Sequence4">
                                 <assign name="Assign7">
                                       <copy>
                                             <from>true()</from>
                                                <to variable="AddFlightToClient" part="ok"/>
                                          </copy>
                                          <copy>
                                             <from variable="AddFlightFromClient" part="bookingNumber"/>
                                                <to>$flightList/flightInfo[$numberOfFlights + 1]/bookingNumber
                           <sxed:editor>
                                                         <sxed:predicate path="$flightList/flightInfo[$numberOfFlights + 1]" source="to"/>
                                                      </sxed:editor>
                                                </to>
                                          </copy>
                                          <copy>
                                             <from variable="AddFlightFromClient" part="departure"/>
                                                <to>$flightList/flightInfo[$numberOfFlights + 1]/departure
                           <sxed:editor>
                                                         <sxed:predicate path="$flightList/flightInfo[$numberOfFlights + 1]" source="to"/>
                                                      </sxed:editor>
                                                </to>
                                          </copy>
                                          <copy>
                                             <from variable="AddFlightFromClient" part="price"/>
                                                <to>$flightList/flightInfo[$numberOfFlights + 1]/price
                           <sxed:editor>
                                                         <sxed:predicate path="$flightList/flightInfo[$numberOfFlights + 1]" source="to"/>
                                                      </sxed:editor>
                                                </to>
                                          </copy>
                                          <copy>
                                             <from>false()</from>
                                                <to>$flightList/flightInfo[$numberOfFlights + 1]/isBooked
                           <sxed:editor>
                                                         <sxed:predicate path="$flightList/flightInfo[$numberOfFlights + 1]" source="to"/>
                                                      </sxed:editor>
                                                </to>
                                          </copy>
                                          <copy>
                                             <from>count($flightList/flightInfo)</from>
                                                <to variable="numberOfFlights"/>
                                          </copy>
                                    </assign>
                                    <reply name="Reply4" partnerLink="client" operation="addFlight" portType="ns0:TravelGoodClientPortType" variable="AddFlightToClient"/>
                              </sequence>
                        </onMessage>
                        <onMessage partnerLink="client" operation="getItinerary" portType="ns0:TravelGoodClientPortType" variable="GetItineraryIn">
                           <correlations>
                                 <correlation set="wzrd_set_Reply1_OnMessage_Pick1_getItinerary" initiate="no"/>
                              </correlations>
                              <sequence name="Sequence5">
                                 <assign name="Assign8">
                                       <copy>
                                             <from variable="hotelList"/>
                                                <to variable="GetItineraryOut" part="hotels"/>
                                          </copy>
                                          <copy>
                                             <from variable="flightList"/>
                                                <to variable="GetItineraryOut" part="flights"/>
                                          </copy>
                                    </assign>
                                    <reply name="Reply5" partnerLink="client" operation="getItinerary" portType="ns0:TravelGoodClientPortType" variable="GetItineraryOut"/>
                              </sequence>
                        </onMessage>
                        <onMessage partnerLink="client" operation="addHotel" portType="ns0:TravelGoodClientPortType" variable="AddHotelIn">
                           <correlations>
                                 <correlation set="wzrd_set_Reply1_OnMessage_Pick1_addHotel" initiate="no"/>
                              </correlations>
                              <sequence name="Sequence6">
                                 <assign name="Assign9">
                                       <copy>
                                             <from>true()</from>
                                                <to variable="AddHotelOut" part="ok"/>
                                          </copy>
                                          <copy>
                                             <from>false()</from>
                                                <to>$hotelList/hotelInfo[$numberOfHotels + 1]/isBooked
                           <sxed:editor>
                                                         <sxed:predicate path="$hotelList/hotelInfo[$numberOfHotels + 1]" source="to"/>
                                                      </sxed:editor>
                                                </to>
                                          </copy>
                                          <copy>
                                             <from variable="AddHotelIn" part="price"/>
                                                <to>$hotelList/hotelInfo[$numberOfHotels + 1]/price
                           <sxed:editor>
                                                         <sxed:predicate path="$hotelList/hotelInfo[$numberOfHotels + 1]" source="to"/>
                                                      </sxed:editor>
                                                </to>
                                          </copy>
                                          <copy>
                                             <from variable="AddHotelIn" part="bookingNumber"/>
                                                <to>$hotelList/hotelInfo[$numberOfHotels + 1]/bookingNumber
                           <sxed:editor>
                                                         <sxed:predicate path="$hotelList/hotelInfo[$numberOfHotels + 1]" source="to"/>
                                                      </sxed:editor>
                                                </to>
                                          </copy>
                                          <copy>
                                             <from>count($hotelList/hotelInfo)</from>
                                                <to variable="numberOfHotels"/>
                                          </copy>
                                    </assign>
                                    <reply name="Reply6" partnerLink="client" operation="addHotel" portType="ns0:TravelGoodClientPortType" variable="AddHotelOut"/>
                              </sequence>
                        </onMessage>
                        <onMessage partnerLink="client" operation="bookItinerary" portType="ns0:TravelGoodClientPortType" variable="BookItineraryFromClient">
                           <correlations>
                                 <correlation set="wzrd_set_Reply1_OnMessage_Pick1_bookItinerary" initiate="no"/>
                              </correlations>
                              <sequence name="Sequence8">
                                 <if name="If1">
                                       <condition>$numberOfFlights = 0</condition>
                                          <empty name="Empty1"/>
                                          <else>
                                             <sequence name="Sequence11">
                                                   <forEach name="ForEach1" parallel="no" counterName="ForEach1Counter">
                                                         <startCounterValue>1</startCounterValue>
                                                            <finalCounterValue>$numberOfFlights</finalCounterValue>
                                                            <scope name="Scope1">
                                                               <variables>
                                                                     <variable name="BookFlightsFromServer" messageType="ns2:bookFlightsResponse"/>
                                                                        <variable name="BookFlightsToServer" messageType="ns2:bookFlights"/>
                                                                  </variables>
                                                                  <if name="If2">
                                                                     <condition>$flightBookingStop</condition>
                                                                        <empty name="Empty2"/>
                                                                        <else>
                                                                           <sequence name="Sequence7">
                                                                                 <assign name="Assign10">
                                                                                       <copy>
                                                                                             <from>$flightList/flightInfo[$ForEach1Counter]/bookingNumber
                                             <sxed:editor>
                                                                                                         <sxed:predicate path="$flightList/flightInfo[$ForEach1Counter]" source="from"/>
                                                                                                      </sxed:editor>
                                                                                                </from>
                                                                                                <to>$BookFlightsToServer.parameters/bookingNumber</to>
                                                                                          </copy>
                                                                                          <copy>
                                                                                             <from variable="BookItineraryFromClient" part="ccInfo"/>
                                                                                                <to>$BookFlightsToServer.parameters/creditCard</to>
                                                                                          </copy>
                                                                                    </assign>
                                                                                    <invoke name="Invoke2" partnerLink="LameDuck" operation="bookFlights" portType="ns2:LameDuckWebService" inputVariable="BookFlightsToServer" outputVariable="BookFlightsFromServer"/>
                                                                                    <if name="If3">
                                                                                       <condition>$BookFlightsFromServer.parameters/return</condition>
                                                                                          <assign name="Assign12">
                                                                                             <copy>
                                                                                                   <from>true()</from>
                                                                                                      <to>$flightList/flightInfo[$ForEach1Counter]/isBooked
                                                                                    <sxed:editor>
                                                                                                               <sxed:predicate path="$flightList/flightInfo[$ForEach1Counter]" source="to"/>
                                                                                                            </sxed:editor>
                                                                                                      </to>
                                                                                                </copy>
                                                                                          </assign>
                                                                                          <else>
                                                                                             <sequence name="Sequence9">
                                                                                                   <assign name="Assign11">
                                                                                                         <copy>
                                                                                                               <from>true()</from>
                                                                                                                  <to variable="flightBookingStop"/>
                                                                                                            </copy>
                                                                                                      </assign>
                                                                                                </sequence>
                                                                                          </else>
                                                                                    </if>
                                                                              </sequence>
                                                                        </else>
                                                                  </if>
                                                            </scope>
                                                      </forEach>
                                                </sequence>
                                          </else>
                                    </if>
                                    <if name="If5">
                                       <condition>$numberOfHotels = 0 or $flightBookingStop</condition>
                                          <empty name="Empty4"/>
                                          <else>
                                             <forEach name="ForEach3" parallel="no" counterName="ForEach3Counter">
                                                   <startCounterValue>1</startCounterValue>
                                                      <finalCounterValue>$numberOfHotels</finalCounterValue>
                                                      <scope name="Scope3">
                                                         <variables>
                                                            <variable name="BookItineraryOut1337" messageType="ns0:bookItineraryResponse"/>
                                                            <variable name="BookHotelFromServer" messageType="ns3:bookHotelResponse"/>
                                                                  <variable name="BookHotelToServer" messageType="ns3:bookHotel"/>
                                                            </variables>
                                                            <faultHandlers>
                                                               <catchAll>
                                                                  <sequence name="Sequence22">
                                                                     <assign name="Assign18">
                                                                        <copy>
                                                                              <from>true()</from>
                                                                                 <to variable="flightBookingStop"/>
                                                                           </copy>
                                                                        <copy>
                                                                           <from>false()</from>
                                                                           <to variable="BookItineraryOut1337" part="ok"/>
                                                                        </copy>
                                                                     </assign>
                                                                     <compensate name="Compensate1"/>
                                                                  </sequence>
                                                               </catchAll>
                                                            </faultHandlers>
                                                         <compensationHandler>
                                                            <sequence name="Sequence23">
                                                                <assign name="Assign24">
                                                                    <copy>
                                                                        <from>true()</from>
                                                                        <to variable="flightBookingStop"/>
                                                                    </copy>
                                                                    <copy>
                                                                        <from>false()</from>
                                                                        <to variable="BookItineraryOut1337" part="ok"/>
                                                                    </copy>
                                                                </assign>
                                                            </sequence>
                                                         </compensationHandler>
                                                         <sequence name="Sequence12">
                                                               <if name="If9">
                                                                  <condition>$hotelBookingStop</condition>
                                                                  <sequence name="Sequence20">
                                                                     <empty name="Empty7"/>
                                                                  </sequence>
                                                                  <else>
                                                                     <sequence name="Sequence21">
                                                                        <assign name="Assign16">
                                                                           <copy>
                                                                                 <from>$hotelList/hotelInfo[$ForEach3Counter]/bookingNumber
                                          <sxed:editor>
                                                                                             <sxed:predicate path="$hotelList/hotelInfo[$ForEach3Counter]" source="from"/>
                                                                                          </sxed:editor>
                                                                                    </from>
                                                                                    <to>$BookHotelToServer.parameters/bookingNumber</to>
                                                                              </copy>
                                                                              <copy>
                                                                                 <from variable="BookItineraryFromClient" part="ccInfo"/>
                                                                                    <to>$BookHotelToServer.parameters/creditcard</to>
                                                                              </copy>
                                                                        </assign>
                                                                        <invoke name="Invoke4" partnerLink="NiceView" operation="bookHotel" portType="ns3:NiceView" inputVariable="BookHotelToServer" outputVariable="BookHotelFromServer"/>
                                                                        <assign name="Assign17">
                                                                           <copy>
                                                                                 <from>true()</from>
                                                                                    <to>$hotelList/hotelInfo[$ForEach3Counter]/isBooked
                                          <sxed:editor>
                                                                                             <sxed:predicate path="$hotelList/hotelInfo[$ForEach3Counter]" source="to"/>
                                                                                          </sxed:editor>
                                                                                    </to>
                                                                              </copy>
                                                                        </assign>
                                                                     </sequence>
                                                                  </else>
                                                               </if>
                                                            </sequence>
                                                      </scope>
                                                </forEach>
                                          </else>
                                    </if>
                                    <if name="If6">
                                       <condition>not($flightBookingStop) and not($hotelBookingStop)</condition>
                                          <empty name="Empty5"/>
                                          <else>
                                             <sequence name="Sequence13">
                                                   <forEach name="ForEach2" parallel="no" counterName="ForEach2Counter">
                                                         <startCounterValue>1</startCounterValue>
                                                            <finalCounterValue>$numberOfFlights</finalCounterValue>
                                                            <scope name="Scope2">
                                                               <variables>
                                                                     <variable name="CancelFlightsFromServer" messageType="ns2:cancelFlightsResponse"/>
                                                                        <variable name="CancelFlightsFromClient" messageType="ns2:cancelFlights"/>
                                                                  </variables>
                                                                  <if name="If4">
                                                                     <condition>$flightList/flightInfo[$ForEach2Counter]/isBooked
                                                                                    <sxed:editor>
                                                                                 <sxed:predicate path="$flightList/flightInfo[$ForEach2Counter]" source="from"/>
                                                                              </sxed:editor>
                                                                        </condition>
                                                                        <sequence name="Sequence10">
                                                                           <assign name="Assign14">
                                                                                 <copy>
                                                                                       <from>$flightList/flightInfo[$ForEach2Counter]/price
                                                                                             <sxed:editor>
                                                                                                   <sxed:predicate path="$flightList/flightInfo[$ForEach2Counter]" source="from"/>
                                                                                                </sxed:editor>
                                                                                          </from>
                                                                                          <to>$CancelFlightsFromClient.parameters/amount</to>
                                                                                    </copy>
                                                                                    <copy>
                                                                                       <from>$flightList/flightInfo[$ForEach2Counter]/bookingNumber
                                                                                             <sxed:editor>
                                                                                                   <sxed:predicate path="$flightList/flightInfo[$ForEach2Counter]" source="from"/>
                                                                                                </sxed:editor>
                                                                                          </from>
                                                                                          <to>$CancelFlightsFromClient.parameters/bookingnumber</to>
                                                                                    </copy>
                                                                                    <copy>
                                                                                       <from variable="BookItineraryFromClient" part="ccInfo"/>
                                                                                          <to>$CancelFlightsFromClient.parameters/creditCard</to>
                                                                                    </copy>
                                                                              </assign>
                                                                              <invoke name="Invoke3" partnerLink="LameDuck" operation="cancelFlights" portType="ns2:LameDuckWebService" inputVariable="CancelFlightsFromClient" outputVariable="CancelFlightsFromServer"/>
                                                                              <assign name="Assign15">
                                                                                 <copy>
                                                                                       <from>false()</from>
                                                                                          <to>$flightList/flightInfo[$ForEach2Counter]/isBooked
                                                                                             <sxed:editor>
                                                                                                   <sxed:predicate path="$flightList/flightInfo[$ForEach2Counter]" source="to"/>
                                                                                                </sxed:editor>
                                                                                          </to>
                                                                                    </copy>
                                                                              </assign>
                                                                        </sequence>
                                                                        <else>
                                                                           <empty name="Empty3"/>
                                                                        </else>
                                                                  </if>
                                                            </scope>
                                                      </forEach>
                                                      <forEach name="ForEach4" parallel="no" counterName="ForEach4Counter">
                                                         <startCounterValue>1</startCounterValue>
                                                            <finalCounterValue>$numberOfHotels</finalCounterValue>
                                                            <scope name="Scope4">
                                                               <variables>
                                                                     <variable name="CancelHotelOut" messageType="ns3:cancelHotelResponse"/>
                                                                        <variable name="CancelHotelFromClient" messageType="ns3:cancelHotel"/>
                                                                  </variables>
                                                                  <sequence name="Sequence15">
                                                                     <if name="If7">
                                                                           <condition>$hotelList/hotelInfo[$ForEach4Counter]/isBooked
                                          <sxed:editor>
                                                                                       <sxed:predicate path="$hotelList/hotelInfo[$ForEach4Counter]" source="from"/>
                                                                                    </sxed:editor>
                                                                              </condition>
                                                                              <sequence name="Sequence14">
                                                                                 <assign name="Assign19">
                                                                                       <copy>
                                                                                             <from>$hotelList/hotelInfo[$ForEach4Counter]/bookingNumber
                                                            <sxed:editor>
                                                                                                         <sxed:predicate path="$hotelList/hotelInfo[$ForEach4Counter]" source="from"/>
                                                                                                      </sxed:editor>
                                                                                                </from>
                                                                                                <to>$CancelHotelFromClient.parameters/bookingNumber</to>
                                                                                          </copy>
                                                                                    </assign>
                                                                                    <invoke name="Invoke5" partnerLink="NiceView" operation="cancelHotel" portType="ns3:NiceView" inputVariable="CancelHotelFromClient" outputVariable="CancelHotelOut"/>
                                                                                    <assign name="Assign20">
                                                                                       <copy>
                                                                                             <from>false()</from>
                                                                                                <to>$hotelList/hotelInfo[$ForEach4Counter]/isBooked
                                                            <sxed:editor>
                                                                                                         <sxed:predicate path="$hotelList/hotelInfo[$ForEach4Counter]" source="to"/>
                                                                                                      </sxed:editor>
                                                                                                </to>
                                                                                          </copy>
                                                                                    </assign>
                                                                              </sequence>
                                                                              <else>
                                                                                 <empty name="Empty6"/>
                                                                              </else>
                                                                        </if>
                                                                  </sequence>
                                                            </scope>
                                                      </forEach>
                                                </sequence>
                                          </else>
                                    </if>
                                    <assign name="Assign13">
                                       <copy>
                                             <from>not($flightBookingStop) and not($hotelBookingStop)</from>
                                                <to variable="BookItineraryToClient" part="ok"/>
                                          </copy>
                                       <copy>
                                             <from>not($flightBookingStop) and not($hotelBookingStop)</from>
                                                <to variable="isBooked"/>
                                          </copy>
                                    </assign>
                                 <if name="If12">
                                    <condition>$flightBookingStop or $hotelBookingStop</condition>
                                    <sequence name="Sequence28">
                                       <assign name="Assign32">
                                          <copy>
                                             <from>'BOOKING FAILED'</from>
                                             <to variable="Fault1FaultVar" part="msg"/>
                                          </copy>
                                       </assign>
                                       <reply name="Reply11" partnerLink="client" operation="bookItinerary" portType="ns0:TravelGoodClientPortType" faultName="ns0:fault1" variable="Fault1FaultVar"/>
                                    </sequence>
                                    <else>
                                       <sequence name="Sequence27">
                                          <reply name="Reply7" partnerLink="client" operation="bookItinerary" portType="ns0:TravelGoodClientPortType" variable="BookItineraryToClient"/>
                                       </sequence>
                                    </else>
                                 </if>
                              </sequence>
                        </onMessage>
                  </pick>
               </else>
            </if>
         </sequence>
      </while>
   </sequence>
</process>
